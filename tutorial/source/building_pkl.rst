.. _loading_data:

Build GTFS dictionary (:term:`pkl <pkl>`)
=========================================

Алгоритмы RAPTOR Forward and RAPTOR Backward для вычислений используют предварительно построенные словари, основанные на файлах в формате :term:`GTFS <GTFS>`. Данные словари сохраняются в формате :term:`pkl <pkl>`.

Предварительная подготовка
--------------------------
Необходимо предварительно подготовить следующие данные

- :term:`GTFS <GTFS>` словарь
- слой зданий
- слой дорог

:term:`GTFS <GTFS>` словарь необходимо скачать с соответствующего ресурса например https://gtfs.pro/
Слой зданий и слой дорог должны быть загружены в текущий проект :term:`QGIS <QGIS>`.

Создание словарей :term:`pkl <pkl>`
-----------------------------------
#. Открыть плагин и выбрать пункт меню *Build GTFS dictionary (pkl)*.

   .. image:: ./img/mainwindow.png
      :class: inline, border

#. Откроется диалоговое окно выбора настроек параметров.

   .. image:: ./img/pkl1.png
      :class: inline, border

#. В окне настроек необходимо указать следующие параметры:

   - :guilabel:`GTFS folder`: Выбор папки, в которой расположены файлы GTFS. В папке должны находиться файлы ``stops.txt``, ``stop_times.txt``, ``routes.txt``, ``trips.txt``, ``calendar.txt``.
   - :guilabel:`Layer of roads`: Выбор слоя дорог из текущего проекта.
   - :guilabel:`Layer of buildings`: Выбор слоя зданий из текущего проекта.
   - :guilabel:`Output folder`: Выбор папки для вывода pkl файлов. Необходимо, чтобы были права на запись на данную папку.
   - :guilabel:`Run calculation foothpath on road`: Выбор режима расчета foothpath on road. Если режим не выбран, то расчеты расстояний выполняются по воздуху.

#. Нажмите кнопку **Run** для запуска процесса формирования словарей GTFS.

#. В процессе формирования словарей  отображается информация о ходе вычислений на вкладке **Log**, в строке состояния и progressbar.

#. Процесс вычислений можно прервать, нажав на кнопку **Break**.

.. note:: Если выбран режим :guilabel:`Run calculation foothpath on road` вычисления могут занять много времени. Отображается диалоговое окно c предупреждением.

Диаграммы потоков данных
------------------------

    .. image:: ./img/flowchart1.jpg
      :class: inline, border

    .. image:: ./img/flowchart2.jpg
      :class: inline, border  

