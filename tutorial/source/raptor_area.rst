.. _raptor_area:

Public transport: Forward/backward accessibility AREA, fixed time
=================================================================
Данный режим использует для вычислений accessibility алгоритмы RAPTOR Forward and RAPTOR Backward

Предварительная подготовка
--------------------------
Необходимо предварительно подготовить следующие данные:

- GTFS словарь (Смотрите раздел :doc:`loading_data`)
- слой зданий

Слой зданий должен быть загружен в текущий проект QGIS.

Вычисление
----------
#. Открыть плагин и выбрать пункт меню 

Для режима **Forward accessibility**

*Public transport accessibility AREA -> Forward accessibility AREA, fixed departure time*.

Для режима **Backward accessibility**

*Public transport accessibility AREA -> Backward accessibility AREA, fixed arrival time*.

   .. image:: ./img/mainwindow.png
      :class: inline, border

#. Откроется диалоговое окно настроек параметров.

   .. image:: ./img/pt-fr-a.png
      :class: inline, border

#. В окне настроек необходимо указать следующие параметры:

   - :guilabel:`Dataset folder`: Выбор папки, в которой расположены файлы GTFS dictionary. В папке должны находиться файлы ``stops.pkl``, ``stoptimes.pkl``, ``transfers_dict.pkl``, ``idx_by_route_stop.pkl``, ``routes_by_stop.pkl`` и др.
   - :guilabel:`Output folder`: Выбор папки для вывода протокола работы алгоритма. Необходимо, чтобы были права на запись на данную папку.
   - :guilabel:`Layer of origins`: Выбор слоя стартовых точек из текущего проекта.

   Также необходимо указать прочие параметры в диалоговм окне.
   
#. Нажмите кнопку **Run** для запуска алгоритма.

#. В процессе работы алгоритма отображается информация о ходе вычислений на вкладке **Log**, в строке состояния и progressbar.

#. Процесс вычислений можно прервать, нажав на кнопку **Break**.

.. note:: Если выбрано более 10 зданий в слое :guilabel:`buildings` вычисления могут занять много времени. Отображается диалоговое окно c предупреждением.

.. _raptor_area_structure_rep:

Структура отчета
----------------
+---------------------------+------------------+
| Attribute                 | Value            |
+===========================+==================+
| Origin_ID                 |                  |
+---------------------------+------------------+
| Start_time                |                  |
+---------------------------+------------------+
| Walk\ :sub:`n`\_time      |                  |
+---------------------------+------------------+
| BStop\ :sub:`n`\_ID       |                  |
+---------------------------+------------------+
| Wait\ :sub:`n`\_time      |                  |
+---------------------------+------------------+
| Bus\ :sub:`n`\_start_time |                  |
+---------------------------+------------------+
| Line\ :sub:`n`\_ID        |                  |
+---------------------------+------------------+
| Ride\ :sub:`n`\_time      |                  |
+---------------------------+------------------+
| AStop\ :sub:`n`\_ID       |                  |
+---------------------------+------------------+
| Bus\ :sub:`n`\_finish_time|                  |
+---------------------------+------------------+
| DestWalk_time             |                  |
+---------------------------+------------------+
| Destination_ID            |                  |
+---------------------------+------------------+
| Destination_time          |                  |
+---------------------------+------------------+

для режима **Backward raptor** в отчете дополнительный параметр

+---------------------------+------------------+
|Arrives before             |                  |
+---------------------------+------------------+

.. _raptor_area_flowchart:

Диаграмма потоков данных
------------------------

    .. image:: ./img/flowchart4.jpg
      :class: inline, border
